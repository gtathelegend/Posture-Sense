<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>PostureSense Live Demo | Real-time Posture Detection</title>
  <meta name="description" content="Experience real-time posture detection and correction with our AI-powered smart mirror. Get instant feedback on your exercises and improve your form.">
  <meta name="keywords" content="posture detection, live demo, AI fitness, exercise feedback, real-time correction, smart mirror">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://posturesense.ct.ws/demo">
  <meta property="og:title" content="PostureSense Live Demo | Real-time Posture Detection">
  <meta property="og:description" content="Experience real-time posture detection and correction with our AI-powered smart mirror. Get instant feedback on your exercises and improve your form.">
  <meta property="og:image" content="/static/assets/img/hero-img.jpeg">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://posturesense.ct.ws/demo">
  <meta property="twitter:title" content="PostureSense Live Demo | Real-time Posture Detection">
  <meta property="twitter:description" content="Experience real-time posture detection and correction with our AI-powered smart mirror. Get instant feedback on your exercises and improve your form.">
  <meta property="twitter:image" content="/static/assets/img/hero-img.jpeg">

  <!-- WhatsApp -->
  <meta property="og:site_name" content="Posture Sense">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="website">
  <meta property="og:title" content="PostureSense Live Demo | Real-time Posture Detection">
  <meta property="og:description" content="Experience real-time posture detection and correction with our AI-powered smart mirror. Get instant feedback on your exercises and improve your form.">
  <meta property="og:image" content="/static/assets/img/hero-img.jpeg">
  <meta property="og:url" content="https://posturesense.ct.ws/demo">

  <!-- Favicons -->
  <link href="/static/assets/img/favicon.ico" rel="icon">
  <link href="/static/assets/img/vgu.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/static/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="/static/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="/static/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="/static/assets/css/main.css" rel="stylesheet">

</head>

<body class="starter-page-page">

  <header id="header" class="header d-flex align-items-center fixed-top" style="z-index: 9999;">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="{{ url_for('index')}}" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="/static/assets/img/logo.png" alt=""> -->
        <h1 class="sitename">Posture Sense</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="{{ url_for('index')}}">Home</a></li>
          <li><a href="{{ url_for('index')}}#about">About</a></li>
          <li><a href="{{ url_for('index')}}#features">Features</a></li>
          <li><a href="{{ url_for('pose_detection')}}">Start Learning</a></li>
          <li><a href="{{ url_for('yoga_poses')}}">Yoga Poses</a></li>
          <li><a href="{{ url_for('index')}}#contact">Contact</a></li>
          {% if current_user.is_authenticated %}
          <li><a href="{{ url_for('dashboard')}}">Dashboard</a></li>
          <li><a href="{{ url_for('logout')}}">Logout</a></li>
          {% else %}
          <li><a href="{{ url_for('login')}}">Login</a></li>
          {% endif %}
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title dark-background" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>PostureSense Live Demo</h1>
              <p class="mb-0">Experience real-time posture detection and correction with our AI-powered smart mirror.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="{{ url_for('index')}}">Home</a></li>
            <li class="current">Live Demo</li>
          </ol>
        </div>
      </nav> -->
    </div><!-- End Page Title -->

    <section id="app" class="section">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8 mb-4 mb-lg-0">
            <div class="camera-frame">
              <div id="cameraFeedContainer" class="ratio ratio-16x9 rounded-3 overflow-hidden shadow-lg">
                <img id="video_feed" class="w-100 h-100 object-fit-cover" alt="Live Camera Feed" style="display: none;">
              </div>
              <div class="camera-controls">
                <button id="startCameraButton" class="btn btn-primary">
                  <i class="bi bi-camera-video"></i> Start Camera
                </button>
                <button id="stopCameraButton" class="btn btn-warning" style="display: none;">
                  <i class="bi bi-pause-circle"></i> Stop Camera
                </button>
                <button id="closeCameraButton" class="btn btn-danger" style="display: none;">
                  <i class="bi bi-x-circle"></i> Close Camera
                </button>
              </div>
            </div>
          </div>
          
          <div class="col-lg-4">
            <div class="status-card p-4 rounded-3 shadow-sm">
              <h2 class="h4 mb-4">Posture Detection Status</h2>
              
              <!-- Current Status -->
              <div class="status-info">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="mb-0">Current Status:</h5>
                  <div class="d-flex align-items-center">
                    <span id="pose_status" class="me-2">{{ pose_status if pose_status else 'Unknown' }}</span>
                    <span id="statusDot" class="status-dot"></span>
                  </div>
                </div>
                
                <!-- Last Status -->
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">Last Status:</h5>
                  <div class="d-flex align-items-center">
                    <span id="last_pose_status" class="me-2">{{ last_status if last_status else 'Unknown' }}</span>
                    <span id="lastStatusDot" class="status-dot"></span>
                  </div>
                </div>
              </div>

              <!-- Feedback Message -->
              <div class="feedback-message mt-4 p-3 rounded-3 bg-light">
                <p id="feedbackText" class="mb-0">Start the camera to begin posture detection and receive real-time feedback on your form.</p>
              </div>

              <!-- Instructions -->
              <div class="instructions mt-4">
                <h5 class="h6 mb-3">How to use:</h5>
                <ol class="list-unstyled">
                  <li class="mb-2"><i class="bi bi-1-circle-fill text-primary me-2"></i>Click "Start Camera" to begin</li>
                  <li class="mb-2"><i class="bi bi-2-circle-fill text-primary me-2"></i>Stand in front of the camera</li>
                  <li class="mb-2"><i class="bi bi-3-circle-fill text-primary me-2"></i>Follow the on-screen feedback</li>
                  <li class="mb-2"><i class="bi bi-4-circle-fill text-primary me-2"></i>Use "Stop Camera" to pause</li>
                  <li><i class="bi bi-5-circle-fill text-primary me-2"></i>Click "Close Camera" when done</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <style>
      .camera-frame {
        position: relative;
        border: 2px solid #e9ecef;
        border-radius: 1rem;
        padding: 1rem;
        background: #fff;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        margin: 0 auto;
        max-width: 1000px;
      }

      .camera-controls {
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        right: 1rem;
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(5px);
        border-radius: 0.5rem;
      }

      .camera-controls .btn {
        padding: 0.5rem 1.5rem;
        font-size: 1rem;
      }

      .status-card {
        background: #fff;
        border: 1px solid #e9ecef;
        height: 100%;
      }

      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
      }

      .status-dot.active {
        background-color: #28a745;
      }

      .status-dot.warning {
        background-color: #ffc107;
      }

      .status-dot.danger {
        background-color: #dc3545;
      }

      .feedback-message {
        border-left: 4px solid #0d6efd;
      }

      .instructions li {
        color: #6c757d;
      }

      .instructions i {
        font-size: 0.875rem;
      }

      @media (max-width: 991.98px) {
        .camera-frame {
          margin-bottom: 2rem;
        }
      }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Get the current hostname and port from the window location
        const baseUrl = window.location.protocol + '//' + window.location.host;
        
        const startButton = document.getElementById('startCameraButton');
        const stopButton = document.getElementById('stopCameraButton');
        const closeButton = document.getElementById('closeCameraButton');
        const videoFeed = document.getElementById('video_feed');
        const statusDot = document.getElementById('statusDot');
        const lastStatusDot = document.getElementById('lastStatusDot');
        const feedbackText = document.getElementById('feedbackText');
        const poseStatus = document.getElementById('pose_status');
        const lastPoseStatus = document.getElementById('last_pose_status');
        let statusInterval = null;
        
        // Pose tracking variables
        let currentPose = null;
        let poseStartTime = null;
        let poseAccuracyScore = 0;

        // Initialize status dots based on initial status
        const initialStatus = poseStatus.textContent.trim();
        const initialLastStatus = lastPoseStatus.textContent.trim();
        updateStatusDots(initialStatus);
        updateFeedbackMessage(initialStatus);

        async function startCamera() {
          try {
            // Show loading state
            feedbackText.textContent = "Initializing camera...";
            videoFeed.style.display = 'block';
            
            // Set the video feed source with a timestamp to prevent caching
            videoFeed.src = baseUrl + "/video_feed?" + new Date().getTime();
            
            startButton.style.display = 'none';
            stopButton.style.display = 'inline-block';
            closeButton.style.display = 'inline-block';
            
            // Start polling for status updates
            startStatusUpdates();
          } catch (err) {
            console.error("Error accessing camera:", err);
            feedbackText.textContent = "Error: Could not access camera. Please check your camera connection and permissions.";
            videoFeed.style.display = 'none';
            startButton.style.display = 'inline-block';
            stopButton.style.display = 'none';
            closeButton.style.display = 'none';
          }
        }

        async function stopCamera() {
          try {
            // Save current pose session if there is one
            if (currentPose && poseStartTime) {
              await savePoseSession();
            }
            
            // Call the stop_camera endpoint
            const response = await fetch(baseUrl + "/stop_camera", {
              method: 'GET',
              headers: {
                'Accept': 'application/json'
              }
            });
            if (!response.ok) throw new Error('Failed to stop camera');
            
            // Hide the video feed
            videoFeed.style.display = 'none';
            videoFeed.src = "";
            
            stopButton.style.display = 'none';
            startButton.style.display = 'inline-block';
            feedbackText.textContent = "Camera is paused. Click 'Start Camera' to resume.";
            
            // Stop polling for status updates
            stopStatusUpdates();
          } catch (err) {
            console.error("Error stopping camera:", err);
            feedbackText.textContent = "Error stopping camera. Please try again.";
          }
        }

        async function closeCamera() {
          try {
            // Save current pose session if there is one
            if (currentPose && poseStartTime) {
              await savePoseSession();
            }
            
            // Call the stop_camera endpoint
            const response = await fetch(baseUrl + "/stop_camera", {
              method: 'GET',
              headers: {
                'Accept': 'application/json'
              }
            });
            if (!response.ok) throw new Error('Failed to close camera');
            
            // Hide the video feed
            videoFeed.style.display = 'none';
            videoFeed.src = "";
            
            startButton.style.display = 'inline-block';
            stopButton.style.display = 'none';
            closeButton.style.display = 'none';
            feedbackText.textContent = "Start the camera to begin posture detection and receive real-time feedback on your form.";
            
            // Stop polling for status updates
            stopStatusUpdates();
          } catch (err) {
            console.error("Error closing camera:", err);
            feedbackText.textContent = "Error closing camera. Please try again.";
          }
        }

        function startStatusUpdates() {
          // Poll for status updates every 500ms
          if (!statusInterval) {
            statusInterval = setInterval(updateStatus, 500);
          }
        }

        function stopStatusUpdates() {
          if (statusInterval) {
            clearInterval(statusInterval);
            statusInterval = null;
          }
        }

        async function updateStatus() {
          try {
            const response = await fetch(baseUrl + "/get_status", {
              method: 'GET',
              headers: {
                'Accept': 'application/json'
              }
            });
            if (!response.ok) throw new Error('Failed to get status');
            
            const data = await response.json();
            console.log('Status update:', data); // Debug log
            
            if (data.current_status && data.current_status !== poseStatus.textContent) {
              // Check if pose changed
              const newPose = data.current_status;
              if (newPose !== currentPose && newPose !== 'Unknown' && newPose !== 'Scanning ...') {
                // Save previous pose session if exists
                if (currentPose && poseStartTime) {
                  await savePoseSession();
                }
                // Start new pose tracking
                currentPose = newPose;
                poseStartTime = Date.now();
                poseAccuracyScore = 85 + Math.random() * 15; // Simulated accuracy 85-100%
              }
              
              // Update current status
              poseStatus.textContent = data.current_status;
              
              // Update last status
              lastPoseStatus.textContent = data.last_status;
              
              // Update status indicators
              updateStatusDots(data.current_status);
              
              // Update feedback message based on status
              updateFeedbackMessage(data.current_status);
            }
          } catch (err) {
            console.error("Error updating status:", err);
            // Don't update the feedback text on error to avoid flickering
          }
        }

        async function savePoseSession() {
          if (!currentPose || !poseStartTime) return;
          
          const duration = (Date.now() - poseStartTime) / 1000; // Convert to seconds
          
          // Only save sessions longer than 2 seconds
          if (duration < 2) {
            currentPose = null;
            poseStartTime = null;
            return;
          }
          
          try {
            const response = await fetch(baseUrl + "/save_pose_session", {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              },
              body: JSON.stringify({
                pose_label: currentPose,
                duration: duration,
                accuracy: poseAccuracyScore
              })
            });
            
            if (response.ok) {
              console.log('Pose session saved:', currentPose, duration.toFixed(1) + 's');
            }
          } catch (err) {
            console.error("Error saving pose session:", err);
          }
          
          // Reset tracking variables
          currentPose = null;
          poseStartTime = null;
          poseAccuracyScore = 0;
        }

        function updateFeedbackMessage(status) {
          if (!status) return;
          
          switch(status.toLowerCase()) {
            case 'warrior ii pose':
              feedbackText.textContent = "Great job! You're in the Warrior II pose.";
              break;
            case 't pose':
              feedbackText.textContent = "Perfect! You're in the T pose.";
              break;
            case 'tree pose':
              feedbackText.textContent = "Excellent! You're in the Tree pose.";
              break;
            case 'cobra pose':
              feedbackText.textContent = "Well done! You're in the Cobra pose.";
              break;
            case 'unknown':
              feedbackText.textContent = "Please try to match one of the target poses.";
              break;
            default:
              if (videoFeed.style.display === 'block') {
                feedbackText.textContent = "Camera is active. You can now start your exercises.";
              }
          }
        }

        // Function to update status dots based on status
        function updateStatusDots(status) {
          if (!status) return;
          
          const dotClass = getStatusClass(status);
          statusDot.className = 'status-dot ' + dotClass;
          lastStatusDot.className = 'status-dot ' + getStatusClass(lastPoseStatus.textContent);
        }

        function getStatusClass(status) {
          if (!status) return '';
          status = status.toLowerCase();
          if (status.includes('pose') && status !== 'unknown pose') {
            return 'active';
          } else if (status === 'unknown') {
            return 'warning';
          } else {
            return '';
          }
        }

        startButton.addEventListener('click', startCamera);
        stopButton.addEventListener('click', stopCamera);
        closeButton.addEventListener('click', closeCamera);
      });
    </script>

  <footer id="footer" class="footer dark-background">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="{{ url_for('index')}}" class="logo d-flex align-items-center">
            <span class="sitename">Posture Sense</span>
          </a>
          <div class="footer-contact pt-3">
            <p>Vivekananda Global University</p>
            <p>Jaipur, Rajasthan, 303012</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+91 87500 98715</span></p>
            <p><strong>Email:</strong> <span>info@posturesense.ct.ws</span></p>
          </div>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="{{ url_for('index')}}">Home</a></li>
            <li><a href="{{ url_for('index')}}#about">About us</a></li>
            <li><a href="{{ url_for('index')}}#features">Features</a></li>
            <li><a href="{{ url_for('pose_detection')}}">Demo APP</a></li>
            <li><a href="{{ url_for('yoga_poses')}}">Yoga Poses</a></li>
            <li><a href="{{ url_for('index')}}#contact">Contact</a></li>
          </ul>
        </div>

        <div class="col-lg-4 col-md-12 footer-newsletter">
          <h4>Our Newsletter</h4>
          <p>Subscribe to our newsletter and receive the latest news about our products and services!</p>
          <form id="newsletterForm">
            <div class="newsletter-form">
              <input type="email" name="email" placeholder="Enter your email" required>
              <input type="submit" value="Subscribe">
            </div>
            <div class="loading">Loading</div>
            <div class="error-message"></div>
            <div class="sent-message">Your subscription request has been sent. Thank you!</div>
          </form>

          <style>
            .newsletter-form {
              position: relative;
              display: flex;
              gap: 10px;
            }
            .newsletter-form input[type="email"] {
              flex: 1;
              padding: 12px 15px;
              border: 1px solid rgba(255, 255, 255, 0.1);
              background: rgba(255, 255, 255, 0.05);
              color: #fff;
              border-radius: 4px;
              transition: all 0.3s ease;
            }
            .newsletter-form input[type="email"]:focus {
              background: rgba(255, 255, 255, 0.1);
              border-color: rgba(255, 255, 255, 0.2);
              outline: none;
            }
            .newsletter-form input[type="submit"] {
              padding: 12px 25px;
              background: #4154f1;
              color: #fff;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              transition: all 0.3s ease;
            }
            .newsletter-form input[type="submit"]:hover {
              background: #2b3db8;
            }
            .loading, .error-message, .sent-message {
              display: none;
              margin-top: 10px;
              padding: 10px 15px;
              border-radius: 4px;
            }
            .loading {
              background: rgba(255, 255, 255, 0.1);
              color: #fff;
            }
            .error-message {
              background: rgba(220, 53, 69, 0.1);
              color: #dc3545;
            }
            .sent-message {
              background: rgba(40, 167, 69, 0.1);
              color: #28a745;
            }
          </style>

          <script>
            document.getElementById("newsletterForm").addEventListener("submit", function(event) {
              event.preventDefault();
              
              const form = this;
              const loading = form.querySelector('.loading');
              const sentMessage = form.querySelector('.sent-message');
              
              // Show loading state
              loading.style.display = 'block';
              sentMessage.style.display = 'none';
              
              let formData = new FormData(form);
              
              fetch("/subscribe", {
                method: "POST",
                body: formData
              })
              .then(response => response.json())
              .then(data => {
                loading.style.display = 'none';
                if (data.status === 'success') {
                  sentMessage.textContent = data.message;
                  sentMessage.style.display = 'block';
                  form.reset();
                  
                  // Hide success message after 5 seconds
                  setTimeout(() => {
                    sentMessage.style.display = 'none';
                  }, 5000);
                }
              })
              .catch(error => {
                loading.style.display = 'none';
                console.error('Error:', error);
              });
            });
          </script>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1 sitename">Posture Sense</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed by <a href="tel:9750098715">Vedaang Sharma</a>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="/static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/static/assets/vendor/php-email-form/validate.js"></script>
  <script src="/static/assets/vendor/aos/aos.js"></script>
  <script src="/static/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="/static/assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="/static/assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="/static/assets/js/main.js"></script>

</body>

</html>